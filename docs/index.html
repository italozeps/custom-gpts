
<script>
  // ... (tavs pārējais kods virs šīs vietas)

  const gq = document.getElementById("gq");
  const gout = document.getElementById("gout");
  const gstatus = document.getElementById("gstatus");
  let idxLoaded = false, gMods = [], gTerms = [], gArts = [];

  async function safeFetchJSON(path){
    try { const res = await fetch(path); if(!res.ok) return null; return await res.json(); }
    catch(_) { return null; }
  }

  async function loadIndexes(){
    const [mods, terms, arts] = await Promise.all([
      safeFetchJSON('./index.json'),
      safeFetchJSON('./terms.json'),
      safeFetchJSON('./articles.json')
    ]);

    gMods  = (mods  && Array.isArray(mods.modules))   ? mods.modules   : [];
    gTerms = (terms && Array.isArray(terms.terms))     ? terms.terms    : [];
    gArts  = (arts  && Array.isArray(arts.articles))   ? arts.articles  : [];

    // ✅ jāuzskata par ielādētiem arī tad, ja skaits ir 0
    idxLoaded = (Array.isArray(gMods) && Array.isArray(gTerms) && Array.isArray(gArts));
    gstatus.textContent = `Indeksi ielādēti: moduļi ${gMods.length||0}, termini ${gTerms.length||0}, raksti ${gArts.length||0}`;
  }

  function doGlobalSearch(){
    const q = (gq.value||"").trim().toLowerCase();
    if(!idxLoaded){ gout.classList.add("muted"); gout.textContent = "Indeksi nav ielādēti."; return; }
    if(q.length<2){ gout.classList.add("muted"); gout.textContent = "Ievadi vismaz 2 rakstzīmes."; return; }
    // ... (tavs pārējais meklēšanas kods)
  }

  loadIndexes();
  gq.addEventListener("input", doGlobalSearch);

  // ... (tavs pārējais kods zem šīs vietas)
</script>
