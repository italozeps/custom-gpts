<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Repository Index ¬∑ lingua.id.lv/repo/ (prototype)</title>
  <style>
    :root{--bg:#0b0f14;--card:#121820;--muted:#9fb0c0;--text:#e6edf3;--accent:#4da3ff;--accent2:#7ee787;--ring:#2b3a4b}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Noto Sans","Helvetica Neue",Arial}
    .wrap{max-width:1100px;margin:0 auto;padding:24px}
    header{display:flex;gap:16px;align-items:center;justify-content:space-between;margin-bottom:18px}
    .brand{font-weight:700;letter-spacing:.3px}
    .brand a{color:var(--text);text-decoration:none}
    .nav{display:flex;gap:14px}
    .nav a{color:var(--muted);text-decoration:none}
    .nav a:hover{color:var(--text)}
    .toolbar{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:14px 0 24px}
    .toolbar > *{background:var(--card);border:1px solid var(--ring);border-radius:10px;padding:10px}
    .toolbar input,.toolbar select{width:100%;background:transparent;border:none;outline:none;color:var(--text)}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:14px}
    .card{background:var(--card);border:1px solid var(--ring);border-radius:14px;padding:14px;display:flex;flex-direction:column;gap:10px}
    .card h3{margin:0;font-size:1.05rem}
    .muted{color:var(--muted)}
    .kvs{display:flex;flex-wrap:wrap;gap:8px;font-size:.9rem}
    .kvs span{background:#0c1420;border:1px solid var(--ring);padding:4px 8px;border-radius:999px}
    .actions{display:flex;gap:8px;flex-wrap:wrap}
    .btn{appearance:none;border:1px solid var(--ring);background:#0f1520;color:var(--text);padding:8px 10px;border-radius:10px;text-decoration:none;font-size:.92rem}
    .btn:hover{border-color:#3a4d64}
    .ok{border-color:#284b2f;background:#0e1a12}
    .warn{border-color:#5b3a2b;background:#16110e}
    footer{margin:32px 0 10px;color:var(--muted);font-size:.9rem}
    .pill{display:inline-flex;align-items:center;gap:6px;background:#0e1722;border:1px solid var(--ring);padding:6px 10px;border-radius:999px}
    .status{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .hide{display:none}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand"><a href="#">lingua.id.lv</a> <span class="muted">/ repo (prototype)</span></div>
      <nav class="nav">
        <a href="/pofo/">/pofo/</a>
        <a href="#" title="Alex landing (planned)">/alex/</a>
        <a href="#" title="This page">/repo/</a>
      </nav>
    </header>

    <section class="status">
      <span class="pill">User: <strong id="who">italozeps</strong></span>
      <span class="pill">Repos: <strong id="count">0</strong></span>
      <span class="pill hide" id="rate">API rate: ‚Ä¶</span>
    </section>

    <div class="toolbar">
      <label>
        <div class="muted" style="margin-bottom:6px">GitHub user/org</div>
        <input id="user" value="italozeps" spellcheck="false" />
      </label>
      <label>
        <div class="muted" style="margin-bottom:6px">Filter</div>
        <input id="q" placeholder="Search name/description/language‚Ä¶" />
      </label>
      <label>
        <div class="muted" style="margin-bottom:6px">Sort</div>
        <select id="sort">
          <option value="pushed">Recently updated</option>
          <option value="created">Recently created</option>
          <option value="stars">Stars</option>
          <option value="name">Name A‚ÜíZ</option>
        </select>
      </label>
      <label>
        <div class="muted" style="margin-bottom:6px">Options</div>
        <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
          <label style="display:flex;gap:8px;align-items:center"><input id="hideForks" type="checkbox" checked /> <span class="muted">Hide forks</span></label>
          <label style="display:flex;gap:8px;align-items:center"><input id="onlyUpdated" type="checkbox" /> <span class="muted">Updated in 180 days</span></label>
        </div>
      </label>
    </div>

    <div id="grid" class="grid" aria-live="polite"></div>

    <footer>
      Prototype viewer. Client-side only. Uses the public GitHub API without a token. If something looks off, it might be rate limiting.
    </footer>
  </div>

<script>
const el = (sel)=>document.querySelector(sel);
const grid = el('#grid');
const who = el('#who');
const count = el('#count');
const rate = el('#rate');
const state = {
  user: 'italozeps',
  repos: [],
  filtered: []
};

function fmtDate(s){
  try{ return new Date(s).toISOString().slice(0,10); }catch(e){ return s }
}
function fmtNum(n){ return Intl.NumberFormat('en').format(n||0) }
function pagesURL(user, repo){ return `https://${user}.github.io/${repo}/`; }
function repoCard(r){
  const homepage = r.homepage && r.homepage.trim() ? r.homepage.trim() : null;
  const pages = pagesURL(r.owner.login, r.name);
  const updated = fmtDate(r.pushed_at);
  const isFork = r.fork;
  const lang = r.language || '‚Äî';
  const desc = r.description || '';
  const topics = Array.isArray(r.topics) ? r.topics.slice(0,6) : [];
  return `<article class="card" data-name="${r.name.toLowerCase()}" data-lang="${(lang||'').toLowerCase()}" data-desc="${(desc||'').toLowerCase()}">
    <h3>${r.private? 'üîí ' : ''}${r.name}${isFork? ' <span class="muted" title="Fork">¬∑ fork</span>' : ''}</h3>
    ${desc? `<div class="muted">${desc}</div>`: ''}
    <div class="kvs">
      <span title="Primary language">üß† ${lang}</span>
      <span title="Stars">‚≠ê ${fmtNum(r.stargazers_count)}</span>
      <span title="Forks">üç¥ ${fmtNum(r.forks_count)}</span>
      <span title="Open issues">‚öôÔ∏è ${fmtNum(r.open_issues_count)}</span>
      <span title="Last push">üóìÔ∏è ${updated}</span>
    </div>
    ${topics.length? `<div class="kvs">${topics.map(t=>`<span>#${t}</span>`).join('')}</div>`: ''}
    <div class="actions">
      <a class="btn" href="${r.html_url}" target="https://italozeps.github.io/custom-gpts/cgpt/" rel="noopener">Open repo</a>
      <a class="btn ok" href="${pages}" target="_blank" rel="noopener">Try Pages</a>
      ${homepage? `<a class="btn" href="${homepage}" target="_blank" rel="noopener">Homepage</a>`:''}
      ${r.has_issues? `<a class="btn warn" href="${r.html_url}/issues" target="_blank" rel="noopener">Issues</a>`:''}
    </div>
  </article>`
}

async function getRate(){
  try{
    const res = await fetch('https://api.github.com/rate_limit');
    const js = await res.json();
    const rl = js.resources.core;
    rate.classList.remove('hide');
    rate.textContent = `API rate: ${rl.remaining}/${rl.limit} (resets ${fmtDate(rl.reset*1000)})`;
  }catch(e){ /* ignore */ }
}

async function loadRepos(user){
  who.textContent = user;
  grid.innerHTML = '<div class="muted">Loading‚Ä¶</div>';
  state.user = user;
  let page=1, all=[]; let more=true;
  while(more){
    const url = `https://api.github.com/users/${encodeURIComponent(user)}/repos?per_page=100&page=${page}&sort=updated`;
    const res = await fetch(url, { headers: { 'Accept':'application/vnd.github+json' }});
    if(!res.ok){
      grid.innerHTML = `<div class="muted">GitHub API error: ${res.status} ${res.statusText}</div>`;
      return;
    }
    const batch = await res.json();
    all = all.concat(batch);
    more = batch.length === 100; page++;
  }
  state.repos = all;
  applyFilters();
}

function applyFilters(){
  const q = el('#q').value.trim().toLowerCase();
  const hideForks = el('#hideForks').checked;
  const onlyUpdated = el('#onlyUpdated').checked;
  const horizon = Date.now() - 1000*60*60*24*180; // 180 days

  let items = state.repos.slice();
  if(hideForks) items = items.filter(r=>!r.fork);
  if(onlyUpdated) items = items.filter(r=>new Date(r.pushed_at).getTime()>=horizon);
  if(q){
    items = items.filter(r=>
      r.name.toLowerCase().includes(q) ||
      (r.description||'').toLowerCase().includes(q) ||
      (r.language||'').toLowerCase().includes(q)
    );
  }
  const sortBy = el('#sort').value;
  items.sort((a,b)=>{
    if(sortBy==='pushed') return new Date(b.pushed_at)-new Date(a.pushed_at);
    if(sortBy==='created') return new Date(b.created_at)-new Date(a.created_at);
    if(sortBy==='stars') return (b.stargazers_count||0)-(a.stargazers_count||0);
    if(sortBy==='name') return a.name.localeCompare(b.name);
    return 0;
  });

  state.filtered = items;
  count.textContent = items.length;
  grid.innerHTML = items.map(repoCard).join('');
}

// Hook up controls
['user','q','sort','hideForks','onlyUpdated'].forEach(id=>{
  el('#'+id).addEventListener(id==='user'?'change':'input', e=>{
    if(id==='user') loadRepos(e.target.value.trim()||'italozeps');
    else applyFilters();
  });
});

getRate();
loadRepos(state.user);
</script>
<script data-goatcounter="https://dainize.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>
</body>
</html>
